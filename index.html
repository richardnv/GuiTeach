<!DOCTYPE html>
<html>
<head>
    <title>GuiTeach</title>        
    <style>
        .note-text {
            display: inherit;
            font-size: 12px;
            fill: white;
        }
    </style>
    <script src="note.js" type="text/javascript"></script>
    <script src="guitarneck.js" type="text/javascript"></script>    
</head>
<body>
	<header>
		<h1>Guitar Neck</h1>
	</header>
    <main>
        <label for="displayLayout">Layout:</label>
        <select id="displayLayout" name="displayLayout">
            <option value="1">Lefty Instructor</option>
            <option value="2">Guitar Tab-ish</option>
            <option value="3">Righty Instructor</option>  
        </select>          
        <div id="guitar_neck_container">

        </div>    
        <div id="note_display">
            <h4>Note under cursor:</h4>
            <p id="note_info"></p>
        </div>
        <button id="addStringToNeckBtn">Add a String</button>
        <dialog id="addStringDialog">
            <h4>Add a String</h4>
            <p>Select the note and octave and we will show you a preview of where it will be placed.</p>
            <div id="stringPreview">

            </div>            
            <form id="addAStringTuning" method="dialog">
                <label for="stringRootNote">String Root Note:</label>             
                <select id="stringRootNote" name="stringRootNote">
                    <option value="-1">--Select--</option>
                    <option value="0">C</option>
                    <option value="1">C#</option>
                    <option value="2">D</option>
                    <option value="3">D#</option>
                    <option value="4">E</option>
                    <option value="5">F</option>    
                    <option value="6">F#</option>
                    <option value="7">G</option>
                    <option value="8">G#</option>
                    <option value="9">A</option>
                    <option value="10">A#</option>
                    <option value="11">B</option>
                </select>
                <select id="stringRootOctave" name="stringRootOctave">
                    <option value="-1">--Select--</option>
                    <option value="0">-1</option>
                    <option value="1">0</option>
                    <option value="2">1</option>
                    <option value="3">2</option>
                    <option value="4">3</option>
                    <option value="5">4</option>
                    <option value="6">5</option>
                    <option value="7">6</option>
                    <option value="8">7</option>
                </select>                
                <button id="addStringBtn">Add String</button>
                <button id="cancelAddStringBtn">Cancel</button>
            </form>
        </dialog>
        <button id="removeStringFromNeckBtn"onclick="guitarNeckInstance.removeStringFromNeck()">Remove a String</button>
        <button id="toggleAllNotesBtn" onclick="toggleAllNotes()">Hide all Notes</button>
        <legend>Scale</legend>
        <label for="scaleRootNote">Scale Root Note:</label>
        <select id="scaleRootNote" name="scaleRootNote">
            <option value="C">C</option>
            <option value="C#">C#</option>
            <option value="D">D</option>
            <option value="D#">D#</option>
            <option value="E">E</option>
            <option value="F">F</option>    
            <option value="F#">F#</option>
            <option value="G">G</option>
            <option value="G#">G#</option>
            <option value="A">A</option>
            <option value="A#">A#</option>
            <option value="B">B</option>
        </select>                    
        <label for="scaleType">Scale Type:</label>
        <select id="scaleType" name="scaleType">
            <option value="Major">Major</option>
            <option value="Minor">Minor</option>    
            <option value="Pentatonic">Pentatonic</option>
            <option value="Blues">Blues</option>
            <option value="Harmonic Minor">Harmonic Minor</option>
            <option value="Melodic Minor">Melodic Minor</option>            
        </select>
        <button id="showScaleBtn" onclick="showScale()">Show Scale</button>
    </main>    
</body>
<script>
    const guitarNeckInstance = new GuitarNeck();

    window.onload = function() {
        let svgCont = document.getElementById("guitar_neck_container");
        svgCont.appendChild(guitarNeckInstance.render());             
        guitarNeckInstance.adjustNeckWidth();
        let fingerings = document.querySelectorAll('.fingering');
        fingerings.forEach(fingering => {
            fingering.addEventListener('click', (event) => {
                let noteInfo = document.getElementById('note_info');
                let noteInfoText = "String: ";
                noteInfoText += event.target.getAttribute('data-string') + ", Fret: ";                
                noteInfoText += event.target.getAttribute('data-fret') + ", Note Name: ";
                noteInfoText += event.target.getAttribute('data-note-name') + ", Note Number: ";            
                noteInfoText += event.target.getAttribute('data-note-number') + ", Note Spelling: ";
                noteInfoText += event.target.getAttribute('data-note-spelling');
                noteInfo.innerText = noteInfoText;
            });
        });
    }   
    
    window.onresize = function() {
        guitarNeckInstance.adjustNeckWidth();             
    }

    function handleStringPreview() {
        let stringRootNote = document.getElementById('stringRootNote').value;
        let srnInt = parseInt(stringRootNote);                
        let stringRootOctaveCtrl = document.getElementById('stringRootOctave');
        let sroInt = parseInt(stringRootOctaveCtrl.value);                
        if (srnInt != -1 && sroInt != -1) {
            moveStringPreview(srnInt, sroInt);                        
        }
    }

    stringRootNote.addEventListener('change', () => {
        handleStringPreview();        
    });

    stringRootNote.addEventListener('change', () => {
        handleStringPreview();
    });

    function toggleAllNotes() {
        if (guitarNeckInstance.AllNotesAreHidden()) {
            guitarNeckInstance.showAllNotes();            
            document.getElementById('toggleAllNotesBtn').innerText = 'Hide all Notes';
            return;
        }
        guitarNeckInstance.hideAllNotes();
        document.getElementById('toggleAllNotesBtn').innerText = 'Show all Notes';
    }

    addStringToNeckBtn.addEventListener('click', () => {
        let dialog = document.getElementById('addStringDialog');        
        let previewDiv  = document.getElementById('stringPreview');
        dialog.showModal();
        previewDiv.innerHTML = '';
        previewDiv.appendChild(guitarNeckInstance.renderStringPreview());

    });

    cancelAddStringBtn.addEventListener('click', () => {
        let dialog = document.getElementById('addStringDialog');
        dialog.close();
    });

    addStringBtn.addEventListener('click', () => {
        let dialog = document.getElementById('addStringDialog');                
        let selectedStringRootNote = document.getElementById('stringRootNote').value;
        let selectedStringRootOctave = document.getElementById('stringRootOctave').value;
        let newStringRootNoteNumber = parseInt(selectedStringRootNote) + (12 * parseInt(selectedStringRootOctave));
        guitarNeckInstance.addStringToNeck(newStringRootNoteNumber);
        dialog.close();
    });

    stringRootNote.addEventListener('change', () => {
        let stringRootNote = document.getElementById('stringRootNote').value;
        let srnInt = parseInt(stringRootNote);                
        let stringRootOctaveCtrl = document.getElementById('stringRootOctave');
        // Clears and repopulates the options in the octave select control
        // ensures that the user can't select an octave that would exceed the 24th fret
        stringRootOctaveCtrl.innerHTML = '';
        for (let i = 0; i < 9; i++) {
            let _24thfret = srnInt + (12 * i);
            if (_24thfret > 127) {
                break;
            }
            let option = document.createElement('option');
            option.value = i;
            option.innerText = i - 1;
            stringRootOctaveCtrl.appendChild(option);
        }
    });

    function showScale() {
        let scaleRootNote = document.getElementById('scaleRootNote').value;        
        let scaleType = document.getElementById('scaleType').value;
        guitarNeckInstance.ShowScale(scaleRootNote, scaleType);
    }


    
</script>
</html>