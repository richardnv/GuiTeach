<!DOCTYPE html>
<html>
<head>
    <title>GuiTeach</title>        
    <style>
        .note-text {
            display: inherit;
            font-size: 12px;
            fill: white;
        }
    </style>
    <script src="note.js" type="text/javascript"></script>
    <script src="guitarneck.js" type="text/javascript"></script>    
</head>
<body>
	<header>
		<h1>Guitar Neck</h1>
	</header>
    <main>
        <div id="guitar_neck_container">

        </div>    
        <div id="note_display">
            <h4>Note under cursor:</h4>
            <p id="note_info"></p>
        </div>
        <button id="addStringToNeckBtn">Add a String</button>
        <dialog id="addStringDialog">
            <form id="addAStringTuning" method="dialog">
                <label for="stringRootNote">String Root Number:</label>
                <input type="number" id="stringRootNote" name="stringRootNote" min="0" max="127" required>
                <button id="addStringBtn">Add String</button>
            </form>
        </dialog>
        <button id="removeStringFromNeckBtn"onclick="guitarNeckInstance.removeStringFromNeck()">Remove a String</button>
        <button id="toggleAllNotesBtn" onclick="toggleAllNotes()">Hide all Notes</button>
        <legend>Scale</legend>
        <label for="scaleRootNote">Scale Root Note:</label>
        <select id="scaleRootNote" name="scaleRootNote">
            <option value="C">C</option>
            <option value="C#">C#</option>
            <option value="D">D</option>
            <option value="D#">D#</option>
            <option value="E">E</option>
            <option value="F">F</option>    
            <option value="F#">F#</option>
            <option value="G">G</option>
            <option value="G#">G#</option>
            <option value="A">A</option>
            <option value="A#">A#</option>
            <option value="B">B</option>
        </select>                    
        <label for="scaleType">Scale Type:</label>
        <select id="scaleType" name="scaleType">
            <option value="Major">Major</option>
            <option value="Minor">Minor</option>    
            <option value="Pentatonic">Pentatonic</option>
            <option value="Blues">Blues</option>
            <option value="Harmonic Minor">Harmonic Minor</option>
            <option value="Melodic Minor">Melodic Minor</option>            
        </select>
        <button id="showScaleBtn" onclick="showScale()">Show Scale</button>
    </main>    
</body>
<script>
    const guitarNeckInstance = new GuitarNeck();

    window.onload = function() {
        let svgCont = document.getElementById("guitar_neck_container");
        svgCont.appendChild(guitarNeckInstance.render());             
        guitarNeckInstance.adjustNeckWidth();
        let fingerings = document.querySelectorAll('.fingering');
        fingerings.forEach(fingering => {
            fingering.addEventListener('click', (event) => {
                let noteInfo = document.getElementById('note_info');
                let noteInfoText = "String: ";
                noteInfoText += event.target.getAttribute('data-string') + ", Fret: ";                
                noteInfoText += event.target.getAttribute('data-fret') + ", Note Name: ";
                noteInfoText += event.target.getAttribute('data-note-name') + ", Note Number: ";            
                noteInfoText += event.target.getAttribute('data-note-number') + ", Note Spelling: ";
                noteInfoText += event.target.getAttribute('data-note-spelling');
                noteInfo.innerText = noteInfoText;
            });
        });
    }   
    
    window.onresize = function() {
        guitarNeckInstance.adjustNeckWidth();             
    }

    function toggleAllNotes() {
        if (guitarNeckInstance.AllNotesAreHidden()) {
            guitarNeckInstance.showAllNotes();            
            document.getElementById('toggleAllNotesBtn').innerText = 'Hide all Notes';
            return;
        }
        guitarNeckInstance.hideAllNotes();
        document.getElementById('toggleAllNotesBtn').innerText = 'Show all Notes';
    }

    addStringToNeckBtn.addEventListener('click', () => {
        let dialog = document.getElementById('addStringDialog');
        dialog.showModal();
    });

    addStringBtn.addEventListener('click', () => {
        let dialog = document.getElementById('addStringDialog');
        let newStringRootNote = document.getElementById('stringRootNote').value;
        guitarNeckInstance.addStringToNeck(newStringRootNote);
        dialog.close();
    });

    function showScale() {
        let scaleRootNote = document.getElementById('scaleRootNote').value;        
        let scaleType = document.getElementById('scaleType').value;
        guitarNeckInstance.showScale(scaleRootNote, scaleType);
    }
    
</script>
</html>